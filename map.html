<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <style>
    </style>
</head>
<body>

<script type="module">

    d3.json('311.geojson').then(function(bb) {
        let width = 700;
        let height = 700;
        let projection = d3.geoEqualEarth();
        projection.fitSize([width, height], bb);
        let geoGenerator = d3.geoPath().projection(projection).pointRadius(2);

        let svg = d3.select("body").append('svg').style("width", width).style("height", height);

        svg.append('rect')
            .attr('x', 0)
            .attr('y', 0)
            .attr('width', width)
            .attr('height', height)
            .attr('fill', 'none')
            .attr('stroke', 'black')
            .attr('stroke-width', 2);

        // draw 311 points
        svg.append('g').selectAll('path')
            .data(bb.features)
            .join('path')
            .attr('d', geoGenerator)
            .attr('fill', '#00000030');

        var targetX = 200;
        var targetY = 200;

        // arrowhead
        svg.append('defs').append('marker')
            .attr('id', 'arrowhead')
            .attr('refX', 6)  // size
            .attr('refY', 2)
            .attr('markerWidth', 6)
            .attr('markerHeight', 4)
            .attr('orient', 'auto')
            .append('path')
            .attr('d', 'M 0,0 V 4 L6,2 Z');

        function drawArrowsWithEffect(index) {
            if (index < bb.features.length) {
                var feature = bb.features[index];
                var sourceX = projection(feature.geometry.coordinates)[0];
                var sourceY = projection(feature.geometry.coordinates)[1];

                var path = svg.append("path")
                    .attr("d", `M${sourceX},${sourceY} L${sourceX},${sourceY}`)
                    .style("fill", "none")
                    .style("stroke", "#63c3ff")
                    .style("stroke-width", 2)
                    .attr("marker-end", "url(#arrowhead)");

                path.transition()
                    .duration(100)
                    .attr("d", `M${sourceX},${sourceY} L${targetX},${targetY}`)
                    .on("end", function () {
                        path.remove();
                        svg.append("line")
                            .attr("x1", sourceX)
                            .attr("y1", sourceY)
                            .attr("x2", targetX)
                            .attr("y2", targetY)
                            .style("fill", "none")
                            .style("stroke", "#00000020")
                            .style("stroke-width", 1);
                        drawArrowsWithEffect(index + 1);
                    });
            }
        }

        drawArrowsWithEffect(0);
    });
</script>
</body>
</html>


